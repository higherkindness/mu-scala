<html><head><title>Mu: Schema Evolution - Avro</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="47 Degrees" /><meta name="description" content="A purely functional library for building RPC endpoint-based services" /><meta name="og:image" content="/mu/img/poster.png" /><meta name="image" property="og:image" content="/mu/img/poster.png" /><meta name="og:title" content="Mu: Schema Evolution - Avro" /><meta name="title" property="og:title" content="Mu: Schema Evolution - Avro" /><meta name="og:site_name" content="Mu" /><meta name="og:url" content="https://higherkindness.github.io/mu/" /><meta name="og:type" content="website" /><meta name="og:description" content="A purely functional library for building RPC endpoint-based services" /><link rel="icon" type="image/png" href="/mu/img/favicon.png" /><meta name="twitter:title" content="Mu: Schema Evolution - Avro" /><meta name="twitter:image" content="/mu/img/poster.png" /><meta name="twitter:description" content="A purely functional library for building RPC endpoint-based services" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/mu/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/mu/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/mu/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/mu/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/mu/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/mu/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/mu/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/mu/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/mu/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/mu/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/mu/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/mu/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/mu/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/mu/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/mu/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/mu/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/mu/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/mu/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/mu/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/mu/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/mu/highlight/styles/default.css" /><link rel="stylesheet" href="/mu/css/style.css" /><link rel="stylesheet" href="/mu/css/palette.css" /><link rel="stylesheet" href="/mu/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/mu/" class="brand"><div class="brand-wrapper"><span>Mu</span></div></a></li> <li><a href="/mu/" class="">Quickstart</a></li> <li><a href="/mu/core-concepts" class="">Core concepts</a></li> <li><a href="/mu/streaming" class="">Streaming</a></li> <li><a href="/mu/annotations" class="">Annotations</a></li> <li><a href="/mu/idl-generation" class="">IDL Generation</a></li> <li><a href="/mu/patterns" class="">Patterns</a></li> <li><a href="/mu/ssl-tls" class="">SSL/TLS</a></li> <li><a href="/mu/metrics-reporting" class="">Metrics Reporting</a></li> <li><a href="/mu/decimal-migration-guide" class="">Migration guide for decimal types</a></li> <li><a href="/mu/schema-evolution" class="">Schema Evolution</a> <ul class="sub_section"> <li><a href="/mu/schema-evolution/avro" class="">Avro</a></li> <li><a href="/mu/schema-evolution/proto" class="">Protocol Buffers</a></li></ul></li> <li><a href="/mu/references" class="">References</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/higherkindness/mu"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/higherkindness/mu"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Mu A purely functional library for building RPC endpoint-based services');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Mu A purely functional library for building RPC endpoint-based services');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="higherkindness" data-github-repo="mu"><div class="content-wrapper"><section><h1 id="avro---schema-evolution">Avro - Schema Evolution</h1>

<p>From now on, consider that we are using <code class="highlighter-rouge">AvroWithSchema</code> as the serialization mechanism in your <a href="https://github.com/higherkindness/mu">mu</a> program.</p>

<p>According to the <a href="http://avro.apache.org/docs/current/spec.html#Schema+Resolution">Avro Specs</a>:</p>

<blockquote>
  <p>A reader of Avro data, whether from an RPC or a file, can always parse that data because its schema is provided. But that schema may not be exactly the schema that was expected. For example, if the data was written with a different version of the software than it is read, then records may have had fields added or removed.</p>
</blockquote>

<p>For Scala, this section specifies how such schema differences should be resolved to preserve compatibility. We’ll try to summarise a bit all the possible cases in both ends: request and response. However, you could go deeper by using this <a href="https://github.com/higherkindness/mu-protocol-decimal-update">repo</a> where you can play with all of the possibilities.</p>

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<h2 id="cases">Cases</h2>

<ul>
  <li><a href="#modifying-the-request-client-side">Modifying the Request (Client side)</a>
    <ul>
      <li><a href="#a-adding-a-new-non-optional-field">A: Adding a new non-optional field</a></li>
      <li><a href="#b-adding-a-new-optional-field">B: Adding a new optional field</a></li>
      <li><a href="#c-adding-new-item-to-a-union">C: Adding new item to a union</a></li>
      <li><a href="#d-removing-item-from-a-union">D: Removing item from a union</a></li>
      <li><a href="#e-replacing-item-in-a-union">E: Replacing item in a union</a></li>
      <li><a href="#f-changing-the-type-of-an-existing-field">F: Changing the type of an existing field</a></li>
      <li><a href="#g-renaming-a-field">G: Renaming a field</a></li>
      <li><a href="#h-removing-a-field">H: Removing a field</a></li>
    </ul>
  </li>
  <li><a href="#modifying-the-response-server-side">Modifying the Response (Server side)</a>
    <ul>
      <li><a href="#i-adding-a-new-non-optional-field">I: Adding a new non-optional field</a></li>
      <li><a href="#j-adding-a-new-optional-field">J: Adding a new optional field</a></li>
      <li><a href="#k-adding-a-new-item-to-a-union">K: Adding a new item to a union</a></li>
      <li><a href="#l-removing-item-from-a-union">L: Removing item from a union</a></li>
      <li><a href="#m-replacing-item-from-a-union">M: Replacing item from a union</a></li>
      <li><a href="#n-changing-the-type-of-an-existing-field">N: Changing the type of an existing field</a></li>
      <li><a href="#o-renaming-a-field">O: Renaming a field</a></li>
      <li><a href="#p-removing-a-field">P: Removing a field</a></li>
    </ul>
  </li>
</ul>

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<h3 id="modifying-the-request-client-side">Modifying the Request (Client side)</h3>

<h4 id="a-adding-a-new-non-optional-field">A: Adding a new non-optional field</h4>

<p>You need to specify a default value for the new field.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="b-adding-a-new-optional-field">B: Adding a new optional field</h4>

<p>This is a particular case of the previous scenario, hence, the solution could be providing a default value, that presumably, in Scala would be <code class="highlighter-rouge">None</code>.</p>

<h4 id="c-adding-new-item-to-a-union">C: Adding new item to a union</h4>

<p>In this case, we are safe and no actions are required.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">Boolean</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="d-removing-item-from-a-union">D: Removing item from a union</h4>

<p>In this case, we’d be breaking the compatibility. The only way to deal with this situation is considering this as a change of type, see the next case for details.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">b</span><span class="k">:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span> <span class="o">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">](</span><span class="s">""</span><span class="o">))</span>
</code></pre>
</div>

<h4 id="e-replacing-item-in-a-union">E: Replacing item in a union</h4>

<p>As we saw previously, again we are breaking the compatibility. If the type is replaced, it will work while the provided value is one of the types in common between the previous <code class="highlighter-rouge">coproduct</code> and the new one.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">Boolean</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<p>It will work if the request is:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="nc">Request</span><span class="o">(</span><span class="n">a</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">](</span><span class="mi">10</span><span class="o">))</span>
</code></pre>
</div>

<p>And it will fail if the request is:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="nc">Request</span><span class="o">(</span><span class="n">a</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">](</span><span class="s">"Hi"</span><span class="o">))</span>
</code></pre>
</div>

<h4 id="f-changing-the-type-of-an-existing-field">F: Changing the type of an existing field</h4>

<p>In this case, it’s not possible to deal with a type swap, if we are maintaining the same name of the field. So the solution would be to consider this replacement as a combination of removing the old field/type, and adding a new field with the new type with a default value.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="g-renaming-a-field">G: Renaming a field</h4>

<p>This operation is completely safe, in Avro, the names are not being sent as part of the request, so no matter how they are named.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="h-removing-a-field">H: Removing a field</h4>

<p>No action required. However, keep in mind that the value will be ignored when old clients include it in the request.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Request</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewRequest</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</code></pre>
</div>

<h3 id="modifying-the-response-server-side">Modifying the Response (Server side)</h3>

<h4 id="i-adding-a-new-non-optional-field">I: Adding a new non-optional field</h4>

<p>In this case, the old clients will ignore the value of the new field, so everything will be safe in terms of backward compatibility.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="j-adding-a-new-optional-field">J: Adding a new optional field</h4>

<p>This would be just a particular case of the previous scenario, where the default value would be <code class="highlighter-rouge">None</code>, in the case of <code class="highlighter-rouge">Scala</code>.</p>

<h4 id="k-adding-a-new-item-to-a-union">K: Adding a new item to a union</h4>

<p>In this scenario, the old clients will fail when the result is including the new item. Hence, the solution would be to provide a default value to the old coproduct and creating a new field with the new coproduct.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span>
      <span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span> <span class="o">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">](</span><span class="mi">0</span><span class="o">),</span>
      <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">Boolean</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="l-removing-item-from-a-union">L: Removing item from a union</h4>

<p>No action will be required in this case.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="m-replacing-item-from-a-union">M: Replacing item from a union</h4>

<p>As long as the value of the coproduct belongs to the previous version, the old client should be able to accept the response as valid. Thus, we would need to follow the same approach as above when <em>Adding a new item to a coproduct</em>.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">String</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">:+:</span> <span class="kt">Boolean</span> <span class="kt">:+:</span> <span class="kt">CNil</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="n-changing-the-type-of-an-existing-field">N: Changing the type of an existing field</h4>

<p>It will require providing a default value for the previous type, and then, we would need to create a new field with the new type.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">123</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="o-renaming-a-field">O: Renaming a field</h4>

<p>It’s also safe in Avro, the server responses don’t include the parameter names inside and they will be ignored when the data is serialized and sent through the wire.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="p-removing-a-field">P: Removing a field</h4>

<p>This evolution should never happen since we would lose backward compatibility. Nonetheless, it would work only under the special case that the old response has a default value for the field that we want to delete, where this operation would be feasible by removing the field in the new version of the server response.</p>

<ul>
  <li>Before:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Response</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">123</span><span class="o">)</span>
</code></pre>
</div>

<ul>
  <li>After:</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">NewResponse</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</code></pre>
</div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/mu/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: '47deg/mu'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/mu/js/main.js"></script></body></html>